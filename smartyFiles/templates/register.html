<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../css/css.css"/>
<script src="../js/jquery.min.js" type="text/javascript"></script>
<script src="../js/jquery.form.min.js" type="text/javascript"></script>
<script src="../js/footable.js?v=2-0-1" type="text/javascript"></script>
<script src="../js/footable.filter.js?v=2-0-1" type="text/javascript"></script>
<script src="../js/footable.paginate.js?v=2-0-1" type="text/javascript"></script>
<title>无标题文档</title>
</head>

<body class="body">
    <div class="onbody">
    <!-- 弹出修改框 -->
        <div class="alert">
        <form id="modiRegister" method="post">
            <table width="100%" height="100%" border="0" align="center" style="margin:20px 0;">
              <tr>
                <td height="30" align="right">姓名:</td>
                <td height="30"><input type="text" name="modiAlias" id="modiAlias" /></td>
              </tr>
              <tr>
                <td height="30" align="right">手机号码:</td>
                <td height="30">
                <input type="text" name="modiMobileNo" id="modiMobileNo" />
                <input type="hidden" name="modiUserId" id="modiUserId" />
                <input type="hidden" name="modiMobileId" id="modiMobileId" />
                </td>
              </tr>
               <tr>
                <td height="30" align="right"><input type="submit" class="baocun phone_btn1 phone_sel" value="保存" /></td>
                <td height="30" align="center"><input type="button" class="guanbi phone_btn1 phone_sel" value="关闭" /></td>
              </tr>
            </table>
      </form>
        </div>
     </div>
     <!-- 弹出修改框结束 -->
     
    <!-- 弹出添加框 -->
     <div class="onbody1">
        <div class="alert">
        <form id="addRegister" method="post">
            <table width="100%" height="100%" border="0" align="center" style="margin:20px 0;">
              <tr>
                <td height="30" align="right">姓名:</td>
                <td height="30"><input type="text" name="addAlias" id="addAlias" /></td>
              </tr>
              <tr>
                <td height="30" align="right">手机号码:</td>
                <td height="30">
                <input type="text" name="addMobileNo" id="addMobileNo" /></td>
              </tr>
               <tr>
                <td height="30" align="right"><input type="submit" class="baocun phone_btn1 phone_sel" value="保存" /></td>
                <td height="30" align="center"><input type="button" class="guanbi phone_btn1 phone_sel" value="关闭" /></td>
              </tr>
            </table>
      </form>
        </div>
     </div>   
    <!-- 添加框结束 -->
	<div class="hd">
    	<div class="header">
        	<h1 class="hdtitle">置业小秘书管理系统</h1>
            <div class="nav">
            	<ul class="nav_tab">
                	<li><a href="/">返回首页</a></li>
                    <li class="navcheck"><a href="#">基本信息</a></li>
                    <li><a href="#">数据模块</a></li>
                </ul>
            </div>
            <div class="toolbar">
            	<ul>
                	<li><img src="../images/avatar.png" align="absbottom" /></li>
                	<li><{$adminName}></li>
                	<li>|</li>
                    <li><a href="/logout.php">退出</a></li>
                    <li>|</li>
                    <li><a href="#">帮助</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="md">
    	<div class="position">首页->注册用户数据->基本信息</div>
        <div class="content">
        	<table cellpadding="0" cellspacing="0" class="tbdata" data-filter="#filter" data-filter-text-only="true" data-page-size="10">
            <thead class="thead">
              <tr>
                <th colspan="2" align="center" style="color:#FFF">搜索 : <input id="filter" type="text" class="input" /><span style="font-size:12px">(您可以输入姓名,手机等)</span></th>
                <th align="center"></th>
                <th align="center"></th>
                <th colspan="2" align="center"><input name="" type="button" class="clickAdd add_btn" value="添加新注册用户" /></th>
              </tr>
              <tr bgcolor="#FFFFFF">
                <th align="center" data-toggle="true">姓名</th>
                <th align="center">手机号</th>
                <th align="center">首次关注时间</th>
                <th colspan="2" align="center">&nbsp;</th>
              </tr>
            </thead>
            <tbody class="tbody">
            <{section name=register loop=$registerList}>
              <tr class="tr1">
                <td align="center" id="alias"><{$registerList[register].alias}></td>
                <td align="center" id="mobileNo"><{$registerList[register].mobileNo}></td>
                <td align="center" id="firstTimeUse"><{$registerList[register].firstTimeUse}>
                <input type="hidden" id="userId" value="<{$registerList[register].id}>"/>
                <input type="hidden" id="mobileId" value="<{$registerList[register].mobileId}>"/>
                </td>
                <td align="center" ><input type="button" class="btn clickone" value="修改"></td>
                <td align="center" class="noborder"><input type="button" class="delRegister btn" value="删除" ></td>
              </tr>
              <{/section}>
            </tbody>
            <tfoot>
                  <tr>
                    <td colspan="6">
                    <div id="page" class="pagination pagination-centered"></div>
                    </td>
                  </tr>
            </tfoot>
            </table>
      </div>
    </div>
    <!--foot-->
    <div class="foot">Copyright &copy; 2014 XI CHUAN BIGIT Inc. All Rights Reserved.熙川数字 版权所有</div>
<script type="text/javascript">
$(function(){
	/*弹出添加修改框*/
	$(".clickone").click(function(){
		var userId = $(this).parent().parent().find("#userId").val();
		var mobileId = $(this).parent().parent().find("#mobileId").val();
		var alias = $(this).parent().parent().find("#alias").text();
		var mobileNo = $(this).parent().parent().find("#mobileNo").text();
		$("#modiUserId").val(userId);
		$("#modiMobileId").val(mobileId);
		$("#modiAlias").val(alias);
		$("#modiMobileNo").val(mobileNo);
		$(".onbody").show();
		$('.body').css("background","#EEE","opacity","0.4","z-index","999999");
		$('.tbdata').css("opacity","0.4");
	});
	$(".guanbi").click(function(){
		$(".onbody").hide();
		$(".onbody1").hide();
		$('.body').css("background","#FFF","opacity","1.0");
		$('.tbdata').css("opacity","1");
	});
	/*鼠标放在表格上变色*/
	$(".tbdata tbody tr").mouseover(function(){
		$(this).css("background","#f4f8f9");
	}).mouseout(function(){
		$(this).css("background","#FFF");
	});
	
	$(".clickAdd").click(function(){
		$(".onbody1").show();
		$('.body').css("background","#EEE","opacity","0.4","z-index","999999");
		$('.tbdata').css("opacity","0.4");
	});
	
	$(".guanbi").click(function(){
		$(".onbody").hide();
		$('.body').css("background","#FFF","opacity","1.0");
		$('.tbdata').css("opacity","1");
	});
	/*鼠标放在表格上变色*/
	$(".tbdata tbody tr").mouseover(function(){
		$(this).css("background","#f4f8f9");
	}).mouseout(function(){
		$(this).css("background","#FFF");
	});
	
	/*筛选*/
	$('.tbdata').footable().bind('footable_filtering', function (e) {
// 		alert($(".tbdata tbody tr").length);
// 		var selected = $('.filter-status').find(':selected').text();
// 		if (selected && selected.length > 0) {
// 			e.filter += (e.filter && e.filter.length > 0) ? ' ' + selected : selected;
// 			e.clear = !e.filter;
// 		}
	});

	$('#modiRegister').submit(function() {
		var mobileNo = $('#modiMobileNo').val();
		//alert(mobileNo);
		if(!(mobileNo == '')){
			$('#modiRegister').ajaxSubmit({
				url:"saveRegister.php",
				type:"post",
				datatype: "json",
				success:function(data,status){
					//alert(data.success);
					if(data.success){
						alert('注册用户数据修改成功!');
							$(".guanbi").click();
							location.reload();
						} else alert(data.errInfo);
					}
			}); 
		}else{
			alert('手机号码不能为空');
		}
	return false;
	});
	
	$('#addRegister').submit(function() {
		var mobileNo = $('#addMobileNo').val();
		//alert(mobileNo);
		if(!(mobileNo == '')){
			$('#addRegister').ajaxSubmit({
				url:"addRegister.php",
				type:"post",
				datatype: "json",
				success:function(data,status){
					//alert(data.success);
					if(data.success){
						alert('注册用户数据添加成功!');
							$(".guanbi").click();
							location.reload();
						} else alert(data.errInfo);
					}
			}); 
		}else{
			alert('手机号码不能为空');
		}
	return false;
	});

	$(".delRegister").click(
		function(){
			if (confirm("确认删除")){
				var userId = $(this).parent().parent().find("#userId").val();
				$.ajax({
					type:"POST",
					url:"delRegister.php",
					data:{
						userId:userId
					},
					dataType:"json",
					success:function(retData,textStatus){
						//alert(textStatus);
						if(retData.success){
							alert("删除注册用户成功");
							location.reload();
						} else {
							alert(retData.errInfo+"\n请检查该用户是否已经存在（相同手机号码）。");
						}
					},
					complete:function(){

					},
					error:function(XMLHttpRequest, textStatus, errorThrown){
						alert(errorThrown);
					}
				});
			} else {
				alert("管理员取消了删除");
			}
		}
	);
	
	
});
</script>
</body>
</html>
